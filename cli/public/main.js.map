{"version":3,"file":"public/main.js","sources":["js/controllers/LabelForm.coffee","js/controllers/Menu.coffee","js/controllers/Tag.coffee","js/index.coffee","js/lib/labels.coffee","js/lib/mac.coffee","js/lib/position.js","js/lib/selection.coffee","js/lib/session.coffee","js/models/Tag.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;EAAA;iSAAA;;AAAA;AAEE;;AAAA,WAAC,SAAD,GACE;AAAA,mBAAoB,MAApB;AAAA,IACA,gBAAoB,OADpB;GADF;;AAAA,EAIA,SAAC,OAAD,GACE;AAAA,mBAAgB,MAAhB;GALF;;AAOa;AACX,QAAC,GAAD,GAAM,QAAQ,qBAAR,GAAN;AAAA,IAEA,sDAFA;AAAA,IAIA,IAAC,EAAD,CAAG,qBAAH,CAAyB,CAAC,KAA1B,CAAgC;aAAA,SAAC,GAAD;AAC9B,WAAG,CAAC,cAAJ;AAAA,QACA,GAAG,CAAC,eAAJ,EADA;eAGA,KAAC,MAAK,CAAC,GAAP,CAAW,KAAC,EAAD,CAAG,GAAG,CAAC,MAAP,CAAc,CAAC,IAAf,CAAoB,WAApB,CAAX,EAJ8B;MAAA;IAAA,QAAhC,CAJA,CADW;EAAA,CAPb;;AAAA,sBAkBA,MAAK;AAEH,QAAC,MAAD,GAAS,MAAT;AAAA,IAEA,IAAC,EAAD,CAAG,cAAH,CAAkB,CAAC,IAAnB,CAAwB,WAAxB,CAFA;AAAA,IAGA,IAAC,KAAI,CAAC,GAAN,CAAU,EAAV,CAHA;AAAA,IAIA,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAJA;AAAA,IAMA,IAAC,GAAE,CAAC,KAAJ,EANA;WAOA,IAAC,MAAD,CAAO;aAAG,IAAC,KAAI,CAAC,KAAN,GAAH;IAAA,CAAP,EATG;EAAA,CAlBL;;AAAA,sBA6BA,OAAM,SAAE,KAAF;AAEJ,IAFK,IAAC,cAEN;AAAA,QAAC,EAAD,CAAG,cAAH,CAAkB,CAAC,IAAnB,CAAwB,YAAxB;AAAA,IAEA,IAAC,KAAI,CAAC,GAAN,CAAU,IAAC,MAAK,CAAC,IAAjB,CAFA;AAAA,IAGA,IAAC,MAAK,CAAC,GAAP,CAAW,IAAC,MAAK,CAAC,KAAlB,CAHA;AAAA,IAKA,IAAC,GAAE,CAAC,KAAJ,EALA;WAOA,IAAC,MAAD,CAAO;aAAG,IAAC,KAAI,CAAC,KAAN,GAAH;IAAA,CAAP,EATI;EAAA,CA7BN;;AAAA,sBAwCA,OAAM,SAAC,CAAD;AACJ,KAAC,CAAC,cAAF;AAAA,IAEA,IAAC,GAAE,CAAC,KAAJ,CAAU,MAAV,CAFA;AAIA,QAAG,IAAC,MAAJ;aACE,IAAC,QAAD,CAAS,QAAT,EAAmB,IAAC,MAAK,CAAC,IAA1B,EAAgC,IAAC,QAAD,EAAhC,EADF;KAAA;aAGE,IAAC,QAAD,CAAS,MAAT,EAAiB,IAAC,QAAD,EAAjB,EAHF;KALI;EAAA,CAxCN;;AAAA,sBAoDA,UAAS;WACP;AAAA,YAAM,GAAG,CAAC,OAAJ,CAAY,IAAC,KAAb,CAAN;AAAA,MACA,OAAO,GAAG,CAAC,OAAJ,CAAY,IAAC,MAAb,CADP;MADO;EAAA,CApDT;;mBAAA;;GAFsB,KAAK,CAAC,WAA9B;;AAAA,MA0DM,CAAC,OAAP,GAAiB,SA1DjB;;;;ACAA;EAAA;;oBAAA;;AAAA;AAEE;;AAAA,6BAAW,MAAX;;AAAA,EAEA,IAAC,SAAD,GACE;AAAA,mBAAmB,YAAnB;AAAA,IACA,cAAmB,WADnB;GAHF;;AAMa;AACX;AAAA,IAEA,IAAC,QAAD,GAAW,QAAQ,CAAC,OAFpB;AAAA,IAIA,IAAC,OAAD,EAJA,CADW;EAAA,CANb;;AAAA,EAaA,IAAC,KAAD,GAAO,QAAQ,sBAAR,GAbP;;AAAA,EAcA,IAAC,SAAD,GAAW,QAAQ,oBAAR,GAdX;;AAAA,iBAgBA,SAAQ;AACN;AAAA,QAAC,KAAD,CAAM,IAAI,CAAC,IAAX;AAAA,IAEA,IAAC,GAAE,CAAC,IAAJ,CAAS,IAAT,EAAgB,UAAM,IAAC,GAAvB,CAFA;AAAA,IAGA,IAAC,GAAE,CAAC,QAAJ,CAAc,UAAM,IAAC,GAArB,CAHA;AAAA,IAKA,IAAC,WAAU,CAAC,IAAZ,CAAiB,IAAC,OAAlB,CALA;AAMA;AAAA;sBAAA;AAAA,UAAC,UAAS,CAAC,MAAX,CAAkB,IAAC,IAAD,CAAS,QAAI,CAAC,IAAL,CAAU;AAAA,QAAC,UAAD;AAAA,QAAO,SAAS,IAAC,QAAjB;AAAA,QAA0B,MAAM,IAAhC;AAAA,QAAmC,IAAI,IAAI,CAAC,QAA5C;OAAV,CAAT,CAA0E,CAAC,MAA3E,EAAlB;AAAA,KANA;WAQA,IAAC,IATK;EAAA,CAhBR;;AAAA,iBA2BA,UAAS,SAAC,EAAD,EAAK,IAAL;AACP;AAAA;AAAA;mBAAA;AACE,UAAG,CAAC,CAAC,IAAI,CAAC,EAAP,KAAa,EAAhB;AACE,aAAK,CAAL;AACA,eAFF;OAAA,MAGK,IAAG,CAAC,CAAC,IAAI,CAAC,WAAV;AACH,SAAC,CAAC,IAAI,CAAC,WAAP,EAAoB,CAAC,IAArB,CAA0B;iBAAA,SAAC,QAAD;AACxB;AAAA;iBAAA;gCAAA;kBAAwB,EAAE,CAAC,EAAH,KAAS;AAC/B,mCAAK,EAAL;eADF;AAAA;4BADwB;UAAA;QAAA,QAA1B,EADG;OAJP;AAAA,KADO;EAAA,CA3BT;;AAAA,iBAqCA,MAAK,SAAC,IAAD;AACH,QAAC,QAAO,CAAC,GAAT,CAAa,IAAb;WACA,KAFG;EAAA,CArCL;;AAAA,iBAyCA,eAAc,SAAC,IAAD;WACZ,IAAC,QAAO,CAAC,QAAT,CAAkB,IAAlB,EADY;EAAA,CAzCd;;AAAA,EA4CM,IAAC;AACL;;AAAA,WAAC,QAAD,CAAS,KAAK,CAAC,MAAf;;AAEa;AACX,UAAC,MAAD,GAAS,EAAT;AAAA,MACA,IAAC,KAAD,CAAM,QAAN,EAAgB,IAAC,OAAjB,CADA;AAAA,MAEA,IAAC,IAAD,aAAK,SAAL,CAFA,CADW;IAAA,CAFb;;AAAA,sBAOA,MAAK;AACH;AAAA,MADI,+DACJ;AAAA;WAAA;yBAAA;AAAA,0BAAC,OAAD,CAAQ,IAAR;AAAA;sBADG;IAAA,CAPL;;AAAA,sBAUA,SAAQ,SAAC,IAAD;AACN,UAAI,CAAC,IAAL,CAAU,QAAV,EAAoB;eAAA;AAClB;AAAA,UADmB,8DACnB;iBAAA,KAAC,QAAD,cAAS,WAAU,IAAM,4BAAzB,EADkB;QAAA;MAAA,QAApB;AAAA,MAEA,IAAI,CAAC,IAAL,CAAU,SAAV,EAAqB;eAAA;iBACnB,KAAC,MAAK,CAAC,MAAP,CAAc,KAAC,MAAK,CAAC,OAAP,CAAe,IAAf,CAAd,EAAoC,CAApC,EADmB;QAAA;MAAA,QAArB,CAFA;aAKA,IAAC,MAAK,CAAC,IAAP,CAAY,IAAZ,EANM;IAAA,CAVR;;AAAA,sBAkBA,WAAU,SAAC,IAAD;AACR,UAAC,QAAD,aAAS,WAAU,IAAM,iCAAzB;aACA,KAFQ;IAAA,CAlBV;;AAAA,sBAwBA,SAAQ;AACN;AAAA,MADO,wBAAS,8DAChB;AAAA;AAAA;wBAAA;YAAwB,SAAU;AAChC,cAAI,CAAC,UAAL,aAAgB,IAAhB;SADF;AAAA;AAGA,UAA6B,OAA7B;eAAA,OAAO,CAAC,QAAR,gBAAiB,IAAjB;OAJM;IAAA,CAxBR;;mBAAA;;KADqB,KAAK,CAAC,OA5C7B;;AAAA,EA2EM,IAAC;AAEL;;AAAA,8BACE;AAAA,eAAc,aAAd;AAAA,MACA,aAAc,eADd;KADF;;AAAA,IAIA,IAAC,OAAD,GACE;AAAA,eAAU,SAAV;KALF;;AAOa;AACX;AAAA,MAEA,IAAC,GAAE,CAAC,QAAJ,CAAc,eAAW,KAAC,KAAI,CAAC,EAAE,CAAC,OAAT,CAAiB,GAAjB,EAAsB,GAAtB,EAAzB,CAFA,CADW;IAAA,CAPb;;AAAA,mBAYA,UAAS;AACP,eAAS,CAAC,KAAV;AAAA,MAEA,IAAC,YAAW,CAAC,QAAb,CAAsB,SAAtB,CAFA;aAGA,KAJO;IAAA,CAZT;;AAAA,mBAkBA,cAAa;AACX,eAAS,CAAC,IAAV;AAAA,MAEA,IAAC,YAAW,CAAC,WAAb,CAAyB,SAAzB,CAFA;aAGA,KAJW;IAAA,CAlBb;;AAAA,mBAwBA,WAAU;AACR,UAAC,YAAW,CAAC,QAAb,CAAsB,QAAtB;AACA,UAAkC,IAAC,KAAI,CAAC,KAAxC;AAAA,YAAC,KAAI,CAAC,EAAE,CAAC,QAAT,CAAkB,IAAC,KAAI,CAAC,KAAxB;OADA;aAEA,KAHQ;IAAA,CAxBV;;AAAA,mBA6BA,aAAY;AACV,UAAC,YAAW,CAAC,WAAb,CAAyB,QAAzB;AACA,UAAqC,IAAC,KAAI,CAAC,KAA3C;AAAA,YAAC,KAAI,CAAC,EAAE,CAAC,WAAT,CAAqB,IAAC,KAAI,CAAC,KAA3B;OADA;aAEA,KAHU;IAAA,CA7BZ;;AAAA,mBAkCA,UAAS,SAAC,CAAD;AACP,UAAC,MAAD,CAAO;eAAG,IAAC,QAAD,CAAS,QAAT,EAAH;MAAA,CAAP;AAAA,MAEA,CAAC,CAAC,eAAF,EAFA;AAAA,MAGA,CAAC,CAAC,cAAF,EAHA;aAKA,IAAC,SAAD,CAAU,IAAC,KAAI,CAAC,IAAhB,EANO;IAAA,CAlCT;;AAAA,IA0CA,IAAC,SAAD,GAAW,QAAQ,oBAAR,CA1CX;;AAAA,mBA4CA,MAAK,SAAC,IAAD;AACH,UAAC,QAAO,CAAC,GAAT,CAAa,IAAb;aACA,KAFG;IAAA,CA5CL;;AAAA,mBAgDA,SAAQ;AACN,UAAC,YAAW,CAAC,IAAb,CAAkB,CAAC,IAAC,KAAI,CAAC,MAAN,IAAgB,IAAI,CAAC,IAAI,CAAC,QAA3B,EAAqC,IAAC,KAAtC,CAAlB;AAEA,UAAG,IAAC,KAAI,CAAC,WAAT;AACE,YAAC,KAAI,CAAC,WAAN,EAAmB,CAAC,IAApB,CAAyB;iBAAA,SAAC,QAAD;AACvB;AAAA;iBAAA;mCAAA;AACE,iCAAC,cAAa,CAAC,MAAf,CAAsB,KAAC,IAAD,CAAS,QAAI,CAAC,IAAL,CAAU;AAAA,gBAAC,MAAM,KAAP;AAAA,gBAAc,SAAS,KAAC,QAAxB;AAAA,gBAAiC,MAAM,KAAvC;AAAA,gBAA0C,IAAI,IAAI,CAAC,QAAnD;eAAV,CAAT,CAAiF,CAAC,MAAlF,EAAtB,GADF;AAAA;4BADuB;UAAA;QAAA,QAAzB,EADF;OAFA;aAOA,IAAC,IARK;IAAA,CAhDR;;gBAAA;;KAFkB,KAAK,CAAC,WA3E1B;;AAAA,EAuIM,IAAC;qBAEL;;AAAA,0BAAO;aAAG,IAAC,QAAJ;IAAA,CAAP;;AAAA,kBAEA,SAAQ;aAAG,GAAH;IAAA,CAFR;;AAAA,kBAIA,SAAQ,EAJR;;AAAA,kBAMA,MAAK,SAAC,IAAD;AACH,UAAC,GAAD,CAAI,IAAI,CAAC,EAAT;aAEA,IAAC,OAAO,KAAI,CAAC,EAAL,CAAR,GAAuB,SAAK,IAAL,EAHpB;IAAA,CANL;;AAAA,kBAWA,KAAI,SAAC,EAAD;AAEF,UAAG,IAAC,OAAO,IAAX;AACE,YAAC,OAAO,IAAG,CAAC,OAAZ;eAEA,WAAQ,OAAO,KAHjB;OAFE;IAAA,CAXJ;;AAAA,kBAkBA,WAAU,SAAC,EAAD,EAAK,IAAL;aACR,IAAC,SAAD,CAAU,EAAV,EAAc,SAAC,GAAD;AACZ;AAAA,QAAC,eAAD,EAAO,eAAP;AAAA,QACA,IAAI,CAAC,YAAL,CAAkB,IAAlB,CADA;AAEA;iBACE,KAAK,IAAL,EADF;SAAA;AAGR,UADc,UACd,CAHQ;SAHY;MAAA,CAAd,EADQ;IAAA,CAlBV;;AAAA,kBA8BA,WAAU,SAAC,EAAD,EAAK,IAAL;AACR;AAAA;AAAA;WAAA;uBAAA;AACE,0BAAI,CAAC,OAAL,CAAa,EAAb,EAAiB;iBAAA,SAAC,IAAD;AAAU,gBAAqB,IAArB;qBAAA,KAAK;AAAA,gBAAC,UAAD;AAAA,gBAAO,UAAP;eAAL;aAAV;UAAA;QAAA,QAAjB,GADF;AAAA;sBADQ;IAAA,CA9BV;;eAAA;;MAzIF;;cAAA;;GAFiB,KAAK,CAAC,WAAzB;;AAAA,MA6KM,CAAC,OAAP,GAAiB,IA7KjB;;;;ACDA;EAAA;;iSAAA;;AAAA,OAAO,QAAQ,eAAR,CAAP;;AAAA,SAEA,GAAY,QAAQ,0BAAR,CAFZ;;AAAA;mBAIA;;aAAA;;IAJA;;AAAA,GAMS,CAAC;AAER;;AAAA,4BAAW,WAAX;;AAAA,gBAEA,YAAW,QAFX;;AAAA,EAIA,GAAC,SAAD,GACE;AAAA,kBAAqB,SAArB;AAAA,IACA,iBAAoB,aADpB;GALF;;AAAA,EAQA,GAAC,OAAD,GACE;AAAA,kBAAoB,KAApB;AAAA,IACA,iBAAoB,QADpB;GATF;;AAYa;AACX;AAAA;AAAA,IAEA,IAAC,OAAD,EAFA;AAAA,IAIA,IAAC,OAAD,CAAQ;AACN,UAAC,IAAD,CAAK,QAAL;aAEA,IAAC,MAAD,CAAO;eAAA;iBACL,IAAI,CAAC,MAAL,GADK;QAAA;MAAA,QAAP,EAHM;IAAA,CAAR,CAJA;AAAA,IAUA,IAAI,CAAC,EAAL,CAAQ,SAAR,EAAmB,IAAC,QAApB,CAVA;AAAA,IAYA,IAAC,GAAD,CAAI,MAAJ,EAAY,IAAC,KAAb,CAZA;AAAA,IAaA,IAAC,GAAD,CAAI,KAAJ,EAAW,IAAC,IAAZ,CAbA;AAAA,IAeA,GAAG,CAAC,IAAI,CAAC,EAAT,CAAY,MAAZ,EAAoB,IAAC,QAArB,CAfA;AAAA,IAgBA,GAAG,CAAC,IAAI,CAAC,EAAT,CAAY,QAAZ,EAAsB,IAAC,UAAvB,CAhBA,CADW;EAAA,CAZb;;AAAA,gBA+BA,OAAM,EA/BN;;AAAA,gBAiCA,UAAS;AACP;AAA+B,WAAM,YAAY,IAAC,KAAI,CAAC,MAAxB;AAA/B,UAAC,KAAK,aAAY,CAAZ,CAAc,CAAC,OAArB,GAA+B;IAAA,CAA/B;AAEA;AAAA;SAAA;sBAAA;AAEE,wBAAC,QAAO,CAAC,MAAT,CAAgB,IAAC,IAAD,CAAS,OAAG,CAAC,GAAJ,CAAQ;AAAA,QAAC,UAAD;AAAA,QAAO,IAAI,GAAG,CAAC,OAAf;AAAA,QAAwB,GAAG,IAAC,YAAW,CAAC,GAAb,EAA3B;AAAA,QAA+C,KAAK,IAApD;OAAR,CAAT,CAAyE,CAAC,EAA1F,GAFF;AAAA;oBAHO;EAAA,CAjCT;;AAAA,gBAwCA,MAAK,SAAC,GAAD;AACH;AAAA,YAAQ,IAAC,KAAI,CAAC,IAAN,CAAW,GAAX,CAAR;AAAA,IAEA,GAAG,CAAC,EAAJ,CAAO,SAAP,EAAkB;aAAA;eAChB,KAAC,KAAI,CAAC,MAAN,CAAa,QAAQ,CAArB,EAAwB,CAAxB,EADgB;MAAA;IAAA,QAAlB,CAFA;WAKA,IANG;EAAA,CAxCL;;AAAA,gBAgDA,OAAM,SAAC,IAAD;WACJ,GAAG,CAAC,IAAI,CAAC,IAAT,CAAc,IAAd,EADI;EAAA,CAhDN;;AAAA,gBAmDA,MAAK,SAAC,IAAD;WACH,IAAC,IAAD,CAAM,SAAK,IAAX,EADG;EAAA,CAnDL;;AAAA,gBAuDA,UAAS,SAAC,IAAD;WACP,IAAC,IAAD,CAAM,aAAS,KAAI,CAAC,SAAL,CAAe,IAAf,EAAf,EADO;EAAA,CAvDT;;AAAA,gBA2DA,YAAW,SAAC,IAAD,EAAO,IAAP;WACT,IAAC,IAAD,CAAM,eAAW,IAAX,GAAiB,KAAjB,GAAqB,KAAI,CAAC,SAAL,CAAe,IAAf,EAA3B,EADS;EAAA,CA3DX;;AAAA,gBA+DA,SAAQ;WACN,IAAC,KAAD,CAAM,GAAG,CAAC,IAAV,EADM;EAAA,CA/DR;;AAAA,EAkEA,GAAC,KAAD,GAAO,QAAQ,qBAAR,GAlEP;;AAAA,EAmEA,GAAC,QAAD,GAAU,QAAQ,uBAAR,GAnEV;;AAAA,gBAqEA,MAAK,SAAC,CAAD;AACH,KAAC,CAAC,cAAF;AAAA,IACA,CAAC,CAAC,eAAF,EADA;WAGA,GAAG,CAAC,IAAI,CAAC,GAAT,GAJG;EAAA,CArEL;;AAAA,gBA2EA,SAAQ;AACN;AAAA,QAAI,IAAC,YAAW,CAAC,GAAb,EAAJ;AACA;AAAA;SAAA;qBAAA;AAAA,uBAAG,CAAC,QAAJ,CAAa,CAAb;AAAA;oBAFM;EAAA,CA3ER;;AAAA,EA+EM,GAAC;AAEL;;AAAA,OAAC,OAAD,GACE;AAAA,qBAAoB,MAApB;AAAA,MACA,cAAoB,KADpB;KADF;;AAIa;AACX;AAAA,MAEA,IAAC,KAAI,CAAC,EAAN,CAAS,QAAT,EAAmB,IAAC,SAApB,CAFA;AAAA,MAIA,IAAC,SAAD,EAJA,CADW;IAAA,CAJb;;AAAA,kBAWA,WAAU,SAAE,CAAF;AACR;AAAA,MADS,IAAC,MACV;AAAA,cAAQ,KAAR;AAAA,MAEA,IAAC,EAAD,CAAG,QAAH,CAAY,CAAC,GAAb,CAAiB,kBAAjB,EAAqC,IAAC,KAAI,CAAC,KAA3C,CAFA;AAAA,MAIA,IAAC,EAAD,CAAG,OAAH,CAAW,CAAC,IAAZ,CACE,IAAC,KAAI,CAAC,IAAI,CAAC,OAAX,CACM,WAAQ,WAAO,IAAC,EAAR,GAAW,QAAnB,CADN,EAEE,SAAC,IAAD,EAAO,EAAP,EAAW,EAAX,EAAe,EAAf;AACE,YAAG,EAAC,EAAJ;AACE,kBAAQ,IAAR;iBACA,KAAE,EAAF,GAAM,kBAAN,GAAuB,EAAvB,GAA2B,SAA3B,GAAmC,GAFrC;SAAA;iBAGK,KAHL;SADF;MAAA,CAFF,CADF,CAJA;aAeA,MAhBQ;IAAA,CAXV;;AAAA,kBA6BA,WAAU;AAER,UAAG,IAAC,EAAD,KAAQ,MAAX;AAEE,YAAC,SAAD,CAAU,IAAC,EAAX,EAFF;OAAA;AAKE,YAAC,EAAD,CAAG,QAAH,CAAY,CAAC,GAAb,CAAiB,kBAAjB,EAAqC,IAAC,KAAI,CAAC,KAA3C;AAAA,QACA,IAAC,EAAD,CAAG,OAAH,CAAW,CAAC,IAAZ,CAAiB,IAAC,KAAI,CAAC,IAAvB,CADA,CALF;OAAA;aAQA,IAAC,IAVO;IAAA,CA7BV;;AAAA,kBAyCA,OAAM,SAAC,CAAD;AACJ,OAAC,CAAC,cAAF;AAAA,MACA,CAAC,CAAC,eAAF,EADA;aAGA,IAAC,IAAG,CAAC,OAAL,CAAa,MAAb,EAAqB,IAAC,KAAtB,EAJI;IAAA,CAzCN;;AAAA,kBA+CA,MAAK,SAAC,CAAD;AACH,OAAC,CAAC,cAAF;AAAA,MACA,CAAC,CAAC,eAAF,EADA;aAGA,IAAC,IAAG,CAAC,OAAL,CAAa,KAAb,EAAoB,IAAC,KAArB,EAJG;IAAA,CA/CL;;eAAA;;KAFiB,KAAK,CAAC,WA/EzB;;AAAA,EAsIA,GAAC,KAAD,GAAO,aAtIP;;aAAA;;GAFoB,KAAK,CAAC,WAN5B;;AAAA,GAgJS,CAAC;AAER;;AAAA,8BAAW,aAAX;;AAAA,kBAEA,YAAW,oBAFX;;AAAA,kBAIA,cACE;AAAA,SAAO,GAAG,CAAC,GAAX;GALF;;AAOa;AAEX,QAAC,OAAD,GAAU;AAAA,MACR,WAAa,KADL;KAAV;AAAA,IAIA,kDAJA,CAFW;EAAA,CAPb;;eAAA;;GAFsB,KAAK,CAAC,MAhJ9B;;AAAA,MAiKM,CAAC,OAAP,GAAiB,GAjKjB;;;;ACAA;EAAA;;;iSAAA;;AAAA,UAAU,QAAQ,gBAAR,CAAV;;AAAA,GACA,GAAU,QAAQ,oBAAR,CADV;;AAGA;AAAA;;;;;;GAHA;;AAAA,KAYK,CAAC,OAAO,UAAE,OAAf,GAAwB;AAEtB;AAAA,EAFuB,wBAAS,8DAEhC;AAAA,eAAa,SAAC,IAAD;AACX;AAAA,QAAI,CAAC,UAAL,aAAgB,IAAhB;AAEA,QAAG,IAAI,CAAC,WAAR;AACE;AAAA;WAAA;yBAAA;AAAA,iCAAW,KAAX;AAAA;sBADF;KAHW;EAAA,CAAb;AAMA;AAAA;oBAAA;QAA8B,SAAU;AACtC,iBAAW,IAAX;KADF;AAAA,GANA;AASA,MAAG,OAAH;AAEE,QAAG,OAAO,CAAC,KAAR,IAAkB,UAAS,OAAO,CAAC,KAAK,CAAC,KAAvB,CAArB;AACE,qBAAM,CAAC,OAAP,CAAc,CAAC,OAAf,cAAuB,WAAU,OAAO,CAAC,KAAO,4BAAhD,EADF;KAAA;WAGA,OAAO,CAAC,QAAR,gBAAiB,IAAjB,EALF;GAXsB;AAAA,CAZxB;;AAAA;AA+BE;;AAAA,KAAC,QAAD,CAAS,KAAK,CAAC,GAAf;;AAAA,EACA,GAAC,QAAD,CAAS,KAAK,CAAC,MAAf,CADA;;AAAA,gBAGA,aAAY;WAAG,EAAC,IAAG,SAAQ,CAAC,IAAhB;EAAA,CAHZ;;AAAA,gBAKA,WAAU,WALV;;AAAA,gBAOA,OAAM,EAPN;;AAAA,gBASA,SAAS,YAAQ,GAAC,UAAE,SAAX,GAAsB,CAAG,GAAC,UAAE,KAAN,GAAgB,MAAM,GAAC,UAAE,KAAzB,GAAmC,EAAnC,CAT/B;;AAAA,gBAWA,UAAS,EAXT;;AAAA,gBAaA,SAAQ,QAAQ,eAAR,CAbR;;AAAA,gBAeA,WAAU,SAAC,IAAD;WACR,KAAK,CAAC,KAAK,CAAC,QAAZ,CAAqB,IAArB,EADQ;EAAA,CAfV;;AAAA,gBAkBA,UAAS,SAAC,CAAD;AACP,QAAI,CAAC,CAAC,GAAF,EAAJ;WACA,CAAC,KAAK,CAAC,CAAC,IAAF,EAAN,KAAmB,GAFZ;EAAA,CAlBT;;AAAA,gBAsBA,UAAS,EAtBT;;AAAA,gBAwBA,UAAS;WAAG,CAAC,CAAC,OAAF,CAAU,QAAQ,CAAC,WAAW,CAAC,KAAK,CAAC,OAA3B,EAAoC,CAAC,GAA/C,EAAH;EAAA,CAxBT;;AAAA,gBA0BA,cAAa,SAAC,GAAD;AACX;AAAA,QAAC,QAAO,CAAC,MAAT,CAAgB,GAAG,CAAC,IAApB,EAA0B,GAAG,CAAC,UAA9B;AAAA,IAEA,IAAC,KAAI,CAAC,OAAN,CAAc,GAAG,CAAC,IAAlB,EAAwB,GAAG,CAAC,IAAI,CAAC,UAAjC,CAFA;AAGA;AAAA;uBAAA;AAAA,UAAC,KAAI,CAAC,QAAN,CAAe,KAAK,CAAC,IAArB,EAA2B,KAAK,CAAC,QAAQ,CAAC,IAAf,CAAoB,IAAC,KAArB,CAA3B;AAAA,KAHA;AAKA;AAAA;uBAAA;AAAA,UAAC,KAAI,CAAC,OAAN,CAAc,GAAd,EAAmB,GAAnB;AAAA,KALA;AAMA;AAAA;SAAA;uBAAA;AAAA,wBAAC,KAAI,CAAC,QAAN,CAAe,GAAf,EAAoB,GAApB;AAAA;oBAPW;EAAA,CA1Bb;;AAAA,gBAmCA,SAAQ;AAEN,QAAC,QAAO,CAAC,MAAT,CAAgB,UAAhB,EAA4B,YAA5B;AAAA,IACA,IAAC,QAAO,CAAC,MAAT,CAAgB,SAAhB,EAA2B,WAA3B,CADA;AAAA,IAGA,IAAC,QAAO,CAAC,MAAT,EAHA;AAAA,IAKA,IAAC,GAAD,CAAI,kBAAJ,EAAwB;aAAA,SAAC,CAAD;AAEtB,YAAG,CAAC,CAAC,SAAF,IAAe,CAAC,CAAC,yBAApB;AACE,iBAAO,WAAW;mBAAG,IAAC,SAAD,CAAU,GAAV,EAAH;UAAA,CAAX,CAAP,CADF;SAAA;eAGA,KAAC,QAAD,GAAW,EALW;MAAA;IAAA,QAAxB,CALA;AAAA,IAYA,IAAC,GAAD,CAAI,eAAJ,EAAqB;aAAA;AACnB,aAAC,QAAD,GAAW,EAAX;eAEA,CAAC,CAAC,SAAF,CACE;AAAA,sBAAY,CAAC,CAAC,IAAd;SADF,EAHmB;MAAA;IAAA,QAArB,CAZA;AAAA,IAkBA,IAAC,GAAD,CAAI,mBAAJ,EAAyB;aAAA;eAAG,KAAC,SAAD,CAAU,GAAV,EAAH;MAAA;IAAA,QAAzB,CAlBA;AAAA,IAoBA,KAAK,CAAC,KAAK,CAAC,KAAZ,CAAkB;AAAA,gBAAU;eAAA;iBAAG,KAAC,SAAD,CAAU,GAAV,EAAH;QAAA;MAAA,QAAV;KAAlB,CApBA;AAAA,IAsBA,IAAC,KAAI,CAAC,KAAN,CAAY;aACV,EAAE,aAAF,CAAgB,CAAC,EAAjB,CAAoB,QAApB,EAA8B;eAC5B,EAAE,IAAF,CAAI,CAAC,QAAL,CAAc,SAAd,CACI,CAAC,GADL,CAEM;AAAA,eAAK,EAAE,IAAF,CAAI,CAAC,QAAL,CAAc,UAAd,CAAyB,CAAC,WAA1B,EAAL;AAAA,UACA,SAAY,IAAC,UAAD,KAAc,CAAjB,GAAwB,CAAxB,GAA+B,GADxC;SAFN,EAD4B;MAAA,CAA9B,EADU;IAAA,CAAZ,CAtBA;WA6BA,EAAE,QAAQ,CAAC,IAAX,CAAgB,CAAC,QAAjB,CAA0B,QAA1B,EA/BM;EAAA,CAnCR;;AAoEa;AACX;AAAA;AAAA,IAEA,IAAC,GAAD,CAAI,QAAJ,EAAc,IAAC,OAAf,CAFA;AAAA,IAIA,IAAC,WAAD,GAAkB,YAAQ,IAAR,CAJlB;AAAA,IAMA,IAAC,KAAD,GAAW,OAAO,CAAC,KANnB;AAAA,IAOA,IAAC,KAAD,GAAW,OAAO,CAAC,IAPnB;AAAA,IAQA,IAAC,QAAD,GAAW,OAAO,CAAC,OARnB,CADW;EAAA,CApEb;;AAAA,EA+EM,GAAC;AAEL;;AAAA,6BAAM,EAAN;;AAAA,IAEA,OAAC,KAAD,GAAO,QAAQ,6BAAR,CAAsC,CAAC,IAAvC,CAA4C,MAA5C,CAFP;;AAIa,qBAAC,IAAD;;QAAC,OAAK;AAAA,UAAC,IAAI,WAAL;;OACjB;AAAA;AAAA;AAAA,+CAAM,IAAN;AAAA,MAEA,IAAC,KAAD,GAAY,SAAK,CAAC,IAAN,CAAW;AAAA,kBAAU,OAAO,CAAC,IAAlB;AAAA,QAAwB,aAAa,IAArC;AAAA,QAA0C,WAAW,uBAArD;AAAA,QAA8E,YAAY;AAAA,UAAC,MAAM,MAAP;SAA1F;OAAX,CAFZ;AAAA,MAIA,IAAC,KAAI,CAAC,EAAN,CAAS,QAAT,EAAmB,IAAC,UAApB,CAJA;AAAA,MAMA,IAAC,OAAD,CAAQ,IAAC,KAAI,CAAC,EAAd,CANA,CADW;IAAA,CAJb;;AAAA,sBAaA,YAAW,SAAC,GAAD;AACT,UAAC,EAAD,CAAG,eAAH,CAAmB,CAAC,IAApB,CAAyB,MAAzB,EAAiC,GAAG,CAAC,UAArC;aACA,IAAC,EAAD,CAAG,+BAAH,CAAmC,CAAC,IAApC,CAAyC,EAAE,GAAG,CAAC,IAAN,CAAW,CAAC,UAAZ,EAAwB,CAAC,CAAlE,EAFS;IAAA,CAbX;;AAAA,sBAiBA,SAAQ;AACN,UAAC,GAAE,CAAC,QAAJ,CAAc,oBAAgB,IAAC,KAAI,CAAC,MAApC;aACA,IAAC,KAAI,CAAC,MAAN,CAAa,IAAC,KAAd,EAFM;IAAA,CAjBR;;AAAA,sBAqBA,SAAQ,SAAC,IAAD,EAAO,UAAP;aACN,IAAC,KAAI,CAAC,IAAN,CAAW;AAAA,QAAC,UAAD;AAAA,QAAO,sBAAP;OAAX,EADM;IAAA,CArBR;;mBAAA;;KAFqB,KAAK,CAAC,WA/E7B;;AAAA,EAyGM,GAAC;AAEL;;AAAA,+BAAW,mBAAX;;AAEa,kBAAC,IAAD;;QAAC,OAAK;AAAA,UAAC,IAAI,UAAL;;OACjB;AAAA;AAAA;AAAA,4CAAM,IAAN,EADW;IAAA,CAFb;;AAAA,mBAKA,UAAS,SAAC,GAAD,EAAM,GAAN;AACP,SAAG,CAAC,KAAJ,GAAY,IAAZ;AAAA,MACA,IAAE,KAAF,GAAS,GADT;aAEA,IAAC,IAAD,CAAK,IAAE,KAAP,EAHO;IAAA,CALT;;AAAA,mBAUA,WAAU,SAAC,GAAD,EAAM,GAAN;AACR;AAAA,UAAkB,eAAc,UAAhC;AAAA,mBAAW,GAAX;OAAA;AAAA,MACA,wBAAa;eAAA;AAAG;iBAAA,aAAE,KAAF,CAAM,CAAC,MAAP,aAAc,SAAd,EAAH;QAAA;MAAA,SADb;aAEA,IAAC,MAAD,CAAO,GAAP,EAAY,QAAZ,EAHQ;IAAA,CAVV;;gBAAA;;KAFkB,KAAK,CAAC,MAzG1B;;AAAA,EA0HM,GAAC;AAEL;;AAAA,kCACE;AAAA,cAAS,GAAG,CAAC,KAAb;KADF;;AAAA,oBAGA,YAAW,iBAHX;;AAKa,mBAAC,IAAD;;QAAC,OAAK;AAAA,UAAC,IAAI,UAAL;;OACjB;AAAA;AAAA;AAAA,6CAAM,IAAN,EADW;IAAA,CALb;;AAAA,oBAQA,UAAS,SAAC,GAAD,EAAM,GAAN;AACP,UAAE,KAAF,GAAa,QAAI;AAAA,eAAO,IAAP;OAAJ,CAAb;aACA,IAAC,IAAD,CAAK,IAAE,KAAP,EAFO;IAAA,CART;;AAAA,oBAYA,WAAU,SAAC,GAAD,EAAM,GAAN;AACR;AAAA,UAAkB,eAAc,UAAhC;AAAA,mBAAW,GAAX;OAAA;AAAA,MACA,wBAAa;eAAA;AAAG;iBAAA,aAAE,KAAF,CAAM,CAAC,MAAP,aAAc,SAAd,EAAH;QAAA;MAAA,SADb;aAEA,IAAC,MAAD,CAAO,GAAP,EAAY,QAAZ,EAHQ;IAAA,CAZV;;iBAAA;;KAFmB,KAAK,CAAC,MA1H3B;;AAAA,gBA8IA,cAAa,SAAC,CAAD,EAAI,CAAJ;AAEX;AAAA,QAAe,MAAK,CAApB;AAAA,aAAO,IAAP;KAAA;AAEA,QAAgB,MAAK,IAAL,IAAa,MAAK,IAAlC;AAAA,aAAO,KAAP;KAFA;AAIA,QAAgB,CAAC,CAAC,MAAF,KAAc,CAAC,CAAC,MAAhC;AAAA,aAAO,KAAP;KAJA;AAAA,IAMA,CAAC,CAAC,IAAF,EANA;AAAA,IAOA,CAAC,CAAC,IAAF,EAPA;AASA,SAAS,6FAAT;AACE,UAAgB,CAAE,GAAF,KAAU,CAAE,GAA5B;AAAA,eAAO,KAAP;OADF;AAAA,KATA;WAYA,KAdW;EAAA,CA9Ib;;aAAA;;GADgB,KAAK,CAAC,OA9BxB;;AAAA,MA6LM,CAAC,OAAP,GAAiB,GA7LjB;;;;ACCA;;AAAA,IAAI,QAAQ,CAAC,WAAW,CAAC,IAAzB;;AAAA;sBAIE;;AAAA,QAAC,UAAD,GAAY;WACV,CAAC,CAAC,OAAF,CAAU,CAAC,CAAC,OAAF,EAAW,CAAC,GAAtB,EADU;EAAA,CAAZ;;AAAA,EAGA,MAAC,SAAD,GAAW,SAAC,KAAD,EAAQ,KAAR;AACT;AAAA,YAAQ,CAAC,CAAC,MAAF,CAAS,KAAT,EAAgB,KAAhB,CAAR;WACA,CAAC,CAAC,IAAF,CACE;AAAA,YAAM,KAAK,CAAC,IAAZ;AAAA,MACA,KAAK,KAAK,CAAC,GADX;AAAA,MAEA,UAAU,MAFV;KADF,EAFS;EAAA,CAHX;;AAAA,EAWA,MAAC,iBAAD,GAAmB,SAAC,IAAD,EAAO,KAAP;AACjB;AAAA,YAAQ,CAAC,CAAC,cAAF,CAAiB,IAAjB,EAAuB,KAAvB,CAAR;WACA,CAAC,CAAC,IAAF,CACE;AAAA,YAAM,KAAK,CAAC,IAAZ;AAAA,MACA,KAAK,KAAK,CAAC,GADX;AAAA,MAEA,UAAU,MAFV;KADF,EAFiB;EAAA,CAXnB;;AAAA,EAmBA,MAAC,YAAD,GAAc,SAAC,IAAD,EAAO,OAAP;AACZ;AAAA,YAAQ,CAAC,CAAC,SAAF,CAAY,IAAZ,EAAkB,OAAlB,CAAR;WACA,CAAC,CAAC,IAAF,CACE;AAAA,YAAM,KAAK,CAAC,IAAZ;AAAA,MACA,KAAK,KAAK,CAAC,GADX;AAAA,MAEA,UAAU,MAFV;KADF,EAFY;EAAA,CAnBd;;AAAA,EA2BA,MAAC,YAAD,GAAc,SAAC,MAAD;AACZ;AAAA,YAAQ,CAAC,CAAC,SAAF,CAAY,MAAZ,CAAR;WACA,CAAC,CAAC,IAAF,CACE;AAAA,YAAM,KAAK,CAAC,IAAZ;AAAA,MACA,KAAK,KAAK,CAAC,GADX;AAAA,MAEA,UAAU,MAFV;KADF,EAFY;EAAA,CA3Bd;;gBAAA;;IAJF;;AAAA,MAuCM,CAAC,OAAP,GAAiB,MAvCjB;;;;ACAA;;AAAA;mBAEE;;AAAA,KAAC,UAAD,GAAY,SAAC,QAAD;WACV,KAAE,KAAI,CAAC,GAAL,KAAa,QAAb,CAAF,GAAyB,GAAzB,GAA2B,OAAM,CAAC,IAAI,CAAC,UAAZ,CAAuB,MAAM,CAAC,IAAI,CAAC,WAAZ,CAAwB,MAAI,EAA5B,CAAvB,GADjB;EAAA,CAAZ;;AAAA,EAGA,GAAC,KAAD,GAAO,SAAC,MAAD,EAAS,EAAT;WACL,MAAM,CAAC,IAAI,CAAC,aAAZ,CAA0B,MAAM,CAAC,IAAP,CAAY,MAAM,CAAC,IAAnB,EAAyB,EAAzB,EAA6B,MAA7B,EAAqC;AAAA,MAAE,SAAS,IAAX;KAArC,CAA1B,EADK;EAAA,CAHP;;AAAA,EAMA,GAAC,YAAD,GAAc,SAAC,KAAD,EAAQ,MAAR,EAAgB,GAAhB,EAAqB,QAArB,EAA+B,IAA/B,EAAqC,QAArC,EAA+C,GAA/C;WACZ,CAAC,KAAD,EAAQ,MAAR,EAAgB,GAAhB,EAAqB,QAArB,EAA+B,IAA/B,EAAqC,YAAY,EAAjD,EAAqD,OAAO,EAA5D,CAA+D,CAAC,IAAhE,CAAqE,IAArE,IAA6E,KADjE;EAAA,CANd;;AAAA,EASA,GAAC,aAAD,GAAe,SAAC,OAAD,EAAU,GAAV,EAAe,GAAf;AACb;AAAA,YAAQ,GAAG,CAAC,SAAJ,CAAc,SAAS,OAAO,CAAC,UAAjB,CAAd,CAAR;AAAA,IACA,KAAQ,GAAG,CAAC,WAAJ,CAAgB,KAAhB,EAAuB,GAAG,CAAC,IAA3B,EAAiC,GAAG,CAAC,GAArC,EAA0C,GAAG,CAAC,QAAJ,IAAgB,WAA1D,EAAuE,GAAG,CAAC,IAAJ,IAAY,EAAnF,CADR;AAAA,IAEA,MAAQ,GAAG,CAAC,IAAJ,CAAS,OAAO,CAAC,MAAjB,EAAyB,EAAzB,CAFR;WAIC,cAAU,QAAO,CAAC,YAAR,IAAwB,OAAO,CAAC,GAAhC,CAAV,GAA+C,aAA/C,GAA2D,KAA3D,GAAkE,WAAlE,GAA4E,GAA5E,GAAiF,KALrE;EAAA,CATf;;aAAA;;IAFF;;AAAA,MAkBM,CAAC,OAAP,GAAiB,GAlBjB;;;CCDA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/OA;AAAA;;ACCA;EAAA;iSAAA;;AAAA;AACE;;AAAA,cAAC,QAAD,CAAS,KAAK,CAAC,MAAf;;AAAA,yBAEA,cAAa,EAFb;;AAIa;AACX,8DADW;EAAA,CAJb;;AAAA,yBAOA,eAAc,SAAC,GAAD;AACZ;AAAA,QAAC,YAAD;;AAAgB;WAAA;wBAAA;AAAA,2BAAK,CAAC,KAAN;AAAA;;QAAhB;WACA,IAAC,QAAD,CAAS,kBAAT,EAFY;EAAA,CAPd;;AAAA,yBAWA,aAAY,SAAC,IAAD;AACV,QAAC,UAAD;WACA,IAAC,SAAD,CAAU,IAAV,EAFU;EAAA,CAXZ;;AAAA,yBAeA,aAAY,SAAC,IAAD;AACV;AAAA,kBAAc,IAAC,WAAD,CAAY,IAAZ,CAAd;AAAA,IACA,IAAC,UAAD,EADA;AAGA,QAAG,WAAH;AAGE,UAAC,QAAD,CAAS,kBAAT;AAAA,MACA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,KAAzC,CADA,CAHF;KAAA;AAOE,UAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;AAAA,MAEA,IAAC,QAAD,CAAS,kBAAT,CAFA;AAAA,MAGA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,IAAzC,CAHA,CAPF;KAHA;WAeA,MAhBU;EAAA,CAfZ;;AAAA,yBAiCA,SAAQ,SAAC,IAAD;AACN;AAAA,YAAQ,IAAC,SAAD,CAAU,IAAV,CAAR;AAEA,QAAG,QAAQ,EAAX;AACE,UAAC,YAAW,CAAC,MAAb,CAAoB,KAApB,EAA2B,CAA3B;AAAA,MAEA,IAAC,QAAD,CAAS,kBAAT,CAFA;AAAA,MAGA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,KAAzC,CAHA,CADF;KAAA;AAOE,UAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;AAAA,MAEA,IAAC,QAAD,CAAS,kBAAT,CAFA;AAAA,MAGA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,IAAzC,CAHA,CAPF;KAFA;WAcA,MAfM;EAAA,CAjCR;;AAAA,yBAkDA,WAAU,SAAC,IAAD;AACR,QAAG,IAAC,SAAD,CAAU,IAAV,MAAmB,EAAtB;AACE,UAAC,YAAW,CAAC,IAAb,CAAkB,IAAlB;AAAA,MAEA,IAAC,QAAD,CAAS,kBAAT,CAFA;AAAA,MAGA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,IAAzC,CAHA,CADF;KAAA;WAMA,MAPQ;EAAA,CAlDV;;AAAA,yBA2DA,QAAO;WAAG,IAAC,YAAW,CAAC,OAAhB;EAAA,CA3DP;;AAAA,yBA6DA,YAAW;AACT;AAAsC;WAAM,YAAY,IAAC,YAAW,CAAC,MAA/B;AAAtC,wBAAC,QAAD,CAAS,IAAC,YAAY,aAAY,CAAZ,CAAtB,GAAsC;IAAA;oBAD7B;EAAA,CA7DX;;AAAA,yBAgEA,UAAS,SAAC,IAAD;AACP;AAAA,YAAQ,IAAC,SAAD,CAAU,IAAV,CAAR;AAEA,QAAG,QAAQ,EAAX;AACE,UAAC,YAAW,CAAC,MAAb,CAAoB,KAApB,EAA2B,CAA3B;AAAA,MAEA,IAAC,QAAD,CAAS,kBAAT,CAFA;AAAA,MAGA,IAAC,QAAD,CAAU,sBAAkB,IAAI,CAAC,GAAjC,EAAyC,KAAzC,CAHA,CADF;KAFA;WAQA,MATO;EAAA,CAhET;;AAAA,yBA2EA,aAAY,SAAC,IAAD;WACV,IAAC,SAAD,CAAU,IAAV,IAAkB,GADR;EAAA,CA3EZ;;AAAA,yBA8EA,eAAc;WACZ,IAAC,aADW;EAAA,CA9Ed;;AAAA,yBAiFA,eAAc;WACZ,IAAC,MAAD,KAAW,EADC;EAAA,CAjFd;;AAAA,yBAsFA,WAAU,SAAC,GAAD;AACR;AAAA;AAAA;kBAAA;UAAiC,GAAG,CAAC,GAAJ,CAAQ,CAAR;AAC/B,eAAO,CAAP;OADF;AAAA;WAEA,GAHQ;EAAA,CAtFV;;sBAAA;;GADyB,KAAK,CAAC,OAAjC;;AAAA,MA4FM,CAAC,OAAP,GAAiB,YA5FjB;;;;ACDA;EAAA;;iSAAA;;AAAA,MAAM,QAAQ,YAAR,CAAN;;AAAA;AAGE;;AAAA,SAAC,QAAD,CAAS,KAAK,CAAC,MAAf;;AAAA,EACA,OAAC,QAAD,CAAS,KAAK,CAAC,GAAf,CADA;;AAAA,oBAGA,YAAW,WAHX;;AAAA,oBAKA,iBAAgB,SAAC,IAAD,IALhB;;AAQa,mBAAE,GAAF;AACX;AAAA,IADY,IAAC,UACb;AAAA;AAAA;AAAA,IAEA,kBAAkB;aAAA,SAAC,CAAD,EAAI,WAAJ;AAChB;AAAA,YAAc,CAAC,CAAC,SAAhB;AAAA,iBAAO,IAAP;SAAA;AACA;AAAA;2BAAA;cAA2C,CAAC,CAAC,YAAY,CAAC,GAAf,CAAmB,SAAC,CAAD;mBAAO,CAAC,CAAC,KAAT;UAAA,CAAnB,CAAiC,CAAC,QAAlC,CAA2C,KAAK,CAAC,IAAjD;AACzC,mBAAO,IAAP;WADF;AAAA,SADA;eAGA,MAJgB;MAAA;IAAA,QAFlB;AAAA,IAQA,CAAC,CAAC,OAAF,CAAU,UAAV,CACG,CAAC,IADJ,CACS;aAAA,SAAC,OAAD;AAEH,YAAgD,OAAO,CAAC,KAAxD;AAAA,iBAAO,OAAO,CAAC,GAAR,CAAY,wBAAZ,CAAP;SAAA;AAEA,YAAG,OAAO,CAAC,SAAR,IAAqB,OAAO,CAAC,yBAAhC;AACE,iBAAO,WAAW;mBAAG,IAAC,SAAD,CAAU,GAAV,EAAH;UAAA,CAAX,CAAP,CADF;SAFA;AAAA,QAKA,KAAC,IAAG,CAAC,OAAL,GAAe,OALf;eAOA,KAAC,IAAG,CAAC,OAAL,EAAc,CAAC,IAAf,CAAoB,SAAC,IAAD;AAElB;AAAA,gBAAM,EAAN;AAAA,UACA,QAAQ,EADR;AAGA;yBAAA;gBAAmB,gBAAgB,OAAhB,EAAyB,CAAzB;AACjB,iBAAG,CAAC,IAAJ,CAAU,aAAS,CAAC,CAAC,IAAX,GAAiB,mBAA3B;aADF;AAAA,WAHA;AAMA;yBAAA;kBAAmB,gBAAgB,OAAhB,EAAyB,CAAzB;;aACjB;AAAA,eAAG,CAAC,IAAJ,CAAU,MAAE,CAAC,CAAC,IAAJ,GAAU,sBAAV,GAA+B,CAAC,CAAC,IAAjC,GAAuC,UAAjD;AAAA,YACA,GAAG,CAAC,IAAJ,CAAU,MAAE,CAAC,CAAC,IAAJ,GAAU,UAAV,GAAmB,CAAC,CAAC,IAArB,GAA2B,KAArC,CADA;AAAA,YAEA,KAAM,MAAE,CAAC,CAAC,IAAJ,GAAU,KAAV,CAAN,GAAwB;AACtB;AAAA,uBAAS,QAAS,QAAI,CAAC,CAAC,IAAf,CAAT;qBACA,WAAW;uBACT,KAAC,IAAG,CAAC,OAAQ,MAAE,CAAC,CAAC,IAAJ,CAAb,GAAgC,WAAO;AAAA,kBAAE,KAAD,KAAC,IAAF;iBAAP,EADvB;cAAA,CAAX,EAFsB;YAAA,CAFxB,CADF;AAAA,WANA;AAcA;eAAA;yBAAA;kBAAmB,gBAAgB,OAAhB,EAAyB,CAAzB;;aACjB;AAAA,eAAG,CAAC,IAAJ,CAAU,MAAE,CAAC,CAAC,IAAJ,GAAU,UAAV,GAAmB,CAAC,CAAC,IAArB,GAA2B,MAArC;AAAA,0BAEA,WAAW;qBACT,QACE;AAAA,sBAAM,GAAN;AAAA,gBACA,UAAU,KADV;AAAA,gBAEA,UAAU;AAER,mBAAC,CAAC,SAAF,CACE;AAAA,gCAAY,SAAC,GAAD,EAAM,GAAN;AAEV;AAAA,0BAAG,GAAG,CAAC,GAAG,CAAC,MAAR,CAAe,SAAf,MAA6B,CAAhC;AACE,8BAAM,GAAG,CAAC,YAAJ,CAAiB,OAAjB,EAA0B,GAA1B,EAA+B,GAA/B,CAAN;AAAA,wBAEA,GAAG,CAAC,gBAAJ,CAAqB,eAArB,EAAsC,GAAtC,CAFA;AAAA,wBAIA,GAAG,CAAC,GAAJ,GAAU,KAAE,KAAC,IAAG,CAAC,MAAP,GAAgB,GAAG,CAAC,GAJ9B;AAAA,wBAKA,GAAG,CAAC,WAAJ,GAAkB,IALlB;+BAOA,GAAG,CAAC,SAAJ,GACE;AAAA,2CAAiB,IAAjB;0BATJ;uBAFU;oBAAA,CAAZ;mBADF;AAAA,kBAcA,WAAW,CAAC;2BAAG,KAAC,IAAG,CAAC,OAAL,CAAa,QAAb,EAAH;kBAAA,CAAD,CAAX,EAAuC,CAAvC,CAdA;yBAgBG,KAAC,uBAAJ,GAlBQ;gBAAA,CAFV;eADF,EAsBE,CAtBF,EADS;YAAA,CAAX,EAFA,CADF;AAAA;0BAhBkB;QAAA,CAApB,EATG;MAAA;IAAA,QADT,CAsDG,CAAC,IAtDJ,CAsDS;aACH,OAAO,CAAC,GAAR,CAAY,mBAAZ,EADG;IAAA,CAtDT,CARA,CADW;EAAA,CARb;;AAAA,oBA0EA,yBAAwB,SAAC,QAAD;AAEtB;;MAFuB,WAAS;KAEhC;AAAA,qBAAiB;aAAA;eAEf,CAAC,CAAC,OAAF,CAAU,UAAV,CACC,CAAC,IADF,CACO,SAAC,CAAD;AAEH,eAAC,IAAD,CAAM,4BAAwB,SAA9B;AAEA,cAAwC,CAAC,CAAC,KAA1C;AAAA,mBAAO,KAAC,IAAG,CAAC,OAAL,CAAa,eAAb,CAAP;WAFA;iBAIA,KAAC,IAAG,CAAC,OAAL,CAAa,kBAAb,EAAiC,CAAjC,EANG;QAAA,CADP,CASC,CAAC,IATF,CASO;AAEH,eAAC,IAAD,CAAM,0BAAsB,SAA5B;iBAEA,KAAC,IAAG,CAAC,OAAL,CAAa,eAAb,EAJG;QAAA,CATP,EAFe;MAAA;IAAA,QAAjB;AAAA,IAiBG,cAAH,EAjBA;WAmBA,IAAC,iBAAD,GAAoB,YAAY,cAAZ,EAA4B,QAA5B,EArBE;EAAA,CA1ExB;;AAAA,oBAiGA,WAAU;AACR,QAAC,IAAD,CAAK,UAAL;WAEA,CAAC,CAAC,OAAF,CAAU,gBAAV,CACC,CAAC,IADF,CACO;aAAA;AAEH,aAAC,IAAD,CAAM,mBAAe,SAArB;eAEA,KAAC,IAAG,CAAC,OAAL,CAAa,mBAAb,EAJG;MAAA;IAAA,QADP,EAHQ;EAAA,CAjGV;;iBAAA;;GADoB,KAAK,CAAC,OAF5B;;AAAA,MA8GM,CAAC,OAAP,GAAiB,OA9GjB;;;;ACCA;EAAA;iSAAA;;AAAA;AAEE;;;;GAAA;;AAAA,KAAC,UAAD,CAAW,KAAX,EAAkB,MAAlB,EAA0B,OAA1B;;AAAA,EAEA,GAAC,OAAD,GAAS;WAEP,CAAC,CAAC,QAAF,CAAW;aAAA,SAAC,QAAD;AAET;AAAA,YAAI,CAAC,CAAC,QAAF,EAAJ;AAAA,QAEA,CAAC,CAAC,IAAF,CAAO,SAAC,IAAD;AACL,eAAC,QAAD,CAAS,IAAT,EAAe;AAAA,mBAAO,IAAP;WAAf;iBACA,QAAQ,CAAC,OAAT,CAAiB,KAAC,IAAD,EAAjB,EAFK;QAAA,CAAP,CAFA;eAMA,GAAG,CAAC,MAAM,CAAC,SAAX,EACG,CAAC,IADJ,CACS,CAAC,CAAC,OADX,EARS;MAAA;IAAA,QAAX,EAFO;EAAA,CAFT;;aAAA;;GAFgB,KAAK,CAAC,MAAxB;;AAAA,MAiBM,CAAC,OAAP,GAAiB,GAjBjB","sourcesContent":["\nclass LabelForm extends Spine.Controller\n\n  @elements:\n    '[name=name]'     : 'name'\n    '[name=color]'    : 'color'\n\n  @events:\n    'submit form' : 'save'\n\n  constructor: ->\n    @el = require('js/views/label/form')()\n\n    super\n\n    @$('.color-cooser-color').click (evt) =>\n      evt.preventDefault()\n      evt.stopPropagation()\n\n      @color.val @$(evt.target).data('hex-color')\n\n  New: ->\n\n    @label = undefined\n\n    @$('.modal-title').html('New Label')\n    @name.val ''\n    @color.val '#fff'\n\n    @el.modal()\n    @delay -> @name.focus()       \n\n  Edit: (@label) ->\n\n    @$('.modal-title').html('Edit Label')\n\n    @name.val @label.name\n    @color.val @label.color\n\n    @el.modal()\n\n    @delay -> @name.focus()\n\n  save: (e) ->\n    e.preventDefault()\n\n    @el.modal('hide')\n\n    if @label\n      @trigger 'update', @label.name, @getInfo()\n    else\n      @trigger 'save', @getInfo()\n\n  # private\n\n  getInfo: ->\n    name: app.cleaned @name\n    color: app.cleaned @color\n\nmodule.exports = LabelForm","\nclass Menu extends Spine.Controller\n\n  className: 'menu' \n\n  @elements:\n    '.menuHeader'    : 'menuHeader'\n    '.menuItems'     : 'menuItems'\n\n  constructor: ->\n    super\n\n    @manager = new Menu.Manager\n\n    @render()\n\n  @tmpl: require('js/views/menu/single')()\n  @itemTmpl: require('js/views/menu/item')()\n\n  render: ->\n    @html Menu.tmpl\n\n    @el.attr 'id', \"menu-#{@id}\"\n    @el.addClass \"menu-#{@id}\"\n\n    @menuHeader.html @header\n    @menuItems.append @add(new Menu.Item({item, manager: @manager, menu: @, el: Menu.itemTmpl})).render() for item in @items\n\n    @el\n\n  getItem: (id, clbk) ->\n    for _ in @manager.items\n      if _.item.id is id\n        clbk _\n        return\n      else if _.item.getChildren\n        _.item.getChildren().done (children) =>\n          for ch in children when ch.id is id\n            clbk ch\n\n  add: (item) ->\n    @manager.add(item)\n    item\n\n  activateItem: (item) ->\n    @manager.activate(item)\n\n  class @Manager extends Spine.Module\n    @include Spine.Events\n\n    constructor: ->\n      @items = []\n      @bind 'change', @change\n      @add(arguments...)\n\n    add: (items...) ->\n      @addOne(item) for item in items\n\n    addOne: (item) ->\n      item.bind 'active', (args...) =>\n        @trigger('change', item, args...)\n      item.bind 'release', =>\n        @items.splice(@items.indexOf(item), 1)\n\n      @items.push(item)\n\n    activate: (item) ->\n      @trigger('change', item, arguments...)\n      item\n\n    # Private\n\n    change: (current, args...) ->\n      for item in @items when item isnt current\n        item.deactivate(args...)\n\n      current.activate(args...) if current    \n\n  class @Item extends Spine.Controller\n\n    elements:\n      '.item'     : 'itemElement'\n      '.children' : 'childElements'\n\n    @events:\n      'click' : 'clicked'\n\n    constructor: ->\n      super\n\n      @el.addClass \"menu-item-#{@item.id.replace('.', '_')}\"\n\n    loading: ->\n      NProgress.start()\n\n      @itemElement.addClass('loading')\n      @\n\n    doneLoading: ->\n      NProgress.done()\n      \n      @itemElement.removeClass('loading')\n      @      \n\n    activate: ->\n      @itemElement.addClass('active')\n      @menu.el.addClass(@item.state) if @item.state\n      @\n\n    deactivate: ->\n      @itemElement.removeClass('active')\n      @menu.el.removeClass(@item.state) if @item.state\n      @\n\n    clicked: (e) ->\n      @delay -> @trigger('active')\n\n      e.stopPropagation()\n      e.preventDefault()\n\n      @navigate @item.href\n\n    @linkTmpl: require('js/views/menu/link')\n\n    add: (item) ->\n      @manager.add(item)\n      item    \n\n    render: ->\n      @itemElement.html (@item.render or Menu.Item.linkTmpl)(@item)\n\n      if @item.getChildren\n        @item.getChildren().done (children) =>\n          for child in children\n            @childElements.append @add(new Menu.Item({item: child, manager: @manager, menu: @, el: Menu.itemTmpl})).render()\n\n      @el\n\n  class @Mgr\n\n    menus: -> @_menus\n\n    routes: -> {}\n\n    _menus: {}\n\n    add: (opts) ->\n      @rm opts.id\n\n      @_menus[opts.id] = new Menu(opts)\n    \n    rm: (id) ->\n\n      if @_menus[id]\n        @_menus[id].release()\n\n        delete @_menus[id]\n\n    activate: (id, clbk) ->\n      @_getMenu(id, (arg) -> \n        {menu, item} = arg\n        menu.activateItem(item)\n        try\n          clbk(item)\n        catch _\n          ;\n      )      \n\n    # private\n\n    _getMenu: (id, clbk) ->\n      for _, menu of @_menus\n        menu.getItem(id, (item) => clbk {menu, item} if item)              \n\nmodule.exports = Menu","TagM = require('js/models/Tag')\n\nLabelForm = require('js/controllers/LabelForm')\n\nclass Tag\n\nclass Tag.Mgr extends Spine.Controller\n\n  logPrefix: '(Tag.Mgr)'\n\n  className: 'labels'\n\n  @elements:\n    '.tags-list'       : 'tagList'\n    '.filter input'   : 'filterInput'    \n\n  @events:\n    'click .new'      : 'New'\n    'input .filter'   : 'Filter'\n\n  constructor: ->\n    super\n\n    @render()\n\n    @active ->\n      @log(\"active\")\n\n      @delay =>\n        TagM.Reload()\n\n    TagM.on 'refresh', @Refresh\n\n    @on 'edit', @Edit\n    @on 'del', @Del\n\n    Mgr.form.on 'save', @saveTag\n    Mgr.form.on 'update', @updateTag    \n\n  tags: []\n\n  Refresh: =>\n    @tags[lastIndex - 1].release() while lastIndex = @tags.length\n\n    for item in TagM.all()\n\n      @tagList.append @add(new Mgr.Row({item, el: Mgr.rowTmpl, q: @filterInput.val(), mgr: @})).el\n\n  add: (tag) ->\n    index = @tags.push(tag)\n\n    tag.on 'release', =>\n      @tags.splice(index - 1, 1)\n\n    tag    \n\n  Edit: (item) ->\n    Mgr.form.Edit(item)\n\n  Del: (item) ->\n    @log \"Del #{item}\"\n    ;\n\n  saveTag: (info) ->\n    @log \"saveTag #{JSON.stringify(info)}\"\n    ;\n\n  updateTag: (name, info) ->\n    @log \"updateTag #{name} : #{JSON.stringify(info)}\"\n    ;\n\n  render: ->\n    @html Mgr.tmpl    \n\n  @tmpl: require('js/views/label/tags')()  \n  @rowTmpl: require('js/views/label/single')()\n\n  New: (e) ->\n    e.preventDefault()\n    e.stopPropagation()\n\n    Mgr.form.New()\n\n  Filter: ->\n    q = @filterInput.val()\n    tag.Filtered(q) for tag in @tags\n\n  class @Row extends Spine.Controller\n\n    @events:\n      'click .edit'     : 'Edit'\n      'click .del'      : 'Del'\n\n    constructor: ->\n      super\n\n      @item.on 'change', @FillData\n\n      @FillData()\n\n    Filtered: (@q) ->\n      found = no\n\n      @$('.color').css('background-color', @item.color)\n\n      @$('.name').html(\n        @item.name.replace(\n          new RegExp(\"^(.*)(#{@q})(.*)$\"), \n          (name, $1, $2, $3) ->\n            if !!$2\n              found = yes\n              \"#{$1}<cite class='q'>#{$2}</cite>#{$3}\" \n            else name\n        )\n      )\n\n      found    \n\n    FillData: ->\n\n      if @q isnt undefined\n\n        @Filtered(@q)          \n\n      else\n        @$('.color').css('background-color', @item.color)\n        @$('.name').html(@item.name)\n\n      @el      \n\n    Edit: (e) ->\n      e.preventDefault()\n      e.stopPropagation()\n\n      @mgr.trigger('edit', @item)\n\n    Del: (e) ->\n      e.preventDefault()\n      e.stopPropagation()\n\n      @mgr.trigger('del', @item)\n\n  @form: new LabelForm  \n\nclass Tag.Stack extends Spine.Stack\n\n  logPrefix: '(Tag.Stack)'\n\n  className: 'spine stack labels'\n\n  controllers:\n    mgr  : Tag.Mgr\n\n  constructor: ->\n\n    @routes = {      \n      '/labels'  : 'mgr'\n    }\n\n    super  \n\nmodule.exports = Tag","Session = require('js/lib/session')\nTag     = require('js/controllers/Tag')\n\n### \n\n# Hack to support hierarchy of stacks\n\n# Activating a child will activate all its direct parent stacks\n# and deactivate all siblings (controllers or stacks), their parents and children recursively\n\n###\n\nSpine.Manager::change = (current, args...) ->\n\n  deactivate = (cont) ->\n    cont.deactivate(args...)\n\n    if cont.controllers\n      deactivate(child) for child in cont.controllers\n\n  for cont in @controllers when cont isnt current\n    deactivate(cont)\n\n  if current\n\n    if current.stack and parent = current.stack.stack # Test `current.stack` to make sure in cases where Manager is used without stacks\n      parent.manager.trigger('change', current.stack, args...)\n\n    current.activate(args...)\n\nclass App extends Spine.Module\n  @include Spine.Log\n  @include Spine.Events\n\n  isLoggedIn: -> !! @sesssion.key\n\n  hostname: 'localhost'\n\n  port: 80  \n\n  server: \"http://#{@::hostname}#{if @::port then ':' + @::port else ''}\"\n\n  session: {}\n  \n  labels: require('js/lib/labels')    \n\n  redirect: (path) ->\n    Spine.Route.redirect path\n\n  cleaned: (k) ->\n    k = k.val()\n    (k && k.trim()) || ''\n\n  modules: {}\n\n  getApps: -> $.getJSON(jsRoutes.controllers.Utils.getApps().url)\n\n  registerApp: (app) ->\n    @topMenu.addApp(app.name, app.defaultUrl)\n\n    @menu.addMenu(app.name, app.menu.controller)\n    @menu.addRoute(route.path, route.callback.bind @menu) for route in app.menu.routes\n\n    @view.addView(key, val) for key, val of app.controllers\n    @view.addRoute(key, val) for key, val of app.routes    \n\n  onLoad: =>\n\n    @topMenu.addApp('archives', '#/archives')\n    @topMenu.addApp('schools', '#/schools')\n    \n    @topMenu.render()\n\n    @on 'session.loggedin', (s) =>\n\n      if s.suspended or s.changePasswordAtNextLogin\n        return setTimeout(-> @redirect '/')\n\n      @session = s\n\n    @on 'session.error', =>\n      @session = {}\n\n      $.ajaxSetup\n        beforeSend: $.noop\n\n    @on 'session.loggedout', => @redirect '/'\n\n    Spine.Route.setup(redirect: => @navigate('/'))\n\n    @menu.delay -> \n      $('.scrollable').on 'scroll', ->\n        $(@).siblings('.shadow')\n            .css\n              top: $(@).siblings('.toolbar').outerHeight(), \n              opacity: if @scrollTop is 0 then 0 else 0.8\n\n    $(document.body).addClass('loaded')\n\n  constructor: ->\n    super    \n\n    @on 'loaded', @onLoad\n\n    @sessionMgr = new Session(@)\n    \n    @view    = new App.Stack\n    @menu    = new App.Menu\n    @topMenu = new App.TopMenu\n\n  class @TopMenu extends Spine.Controller\n\n    apps: []\n\n    @tmpl: require('js/views/util/top-menu/list').bind(window)\n\n    constructor: (args={el: '#top-menu'}) ->\n      super(args)\n\n      @list = new Spine.List(template: TopMenu.tmpl, selectFirst: yes, className: 'dropdown-menu squared', attributes: {role: 'menu'})\n\n      @list.on 'change', @changeApp\n\n      @append @list.el\n\n    changeApp: (app) =>\n      @$('a.current-app').attr('href', app.defaultUrl)\n      @$('a.current-app > .navbar-brand').html(S(app.name).capitalize().s)\n\n    render: ->\n      @el.addClass(\"top-menu-count-#{@apps.length}\") \n      @list.render(@apps)\n\n    addApp: (name, defaultUrl) =>\n      @apps.push({name, defaultUrl})    \n\n  class @Menu extends Spine.Stack\n\n    className: 'menus spine stack'\n\n    constructor: (args={el: '#sidebar'}) ->\n      super(args)\n\n    addMenu: (key, val) =>\n      val.stack = @\n      @[key] = val\n      @add(@[key])\n\n    addRoute: (key, val) =>\n      callback = val if typeof val is 'function'\n      callback or= => @[val].active(arguments...)\n      @route(key, callback)      \n\n  class @Stack extends Spine.Stack\n\n    controllers: \n      labels : Tag.Stack\n\n    className: 'app spine stack'\n\n    constructor: (args={el: '#content'}) ->\n      super(args)\n\n    addView: (key, val) =>\n      @[key] = new val(stack: @)\n      @add(@[key])\n\n    addRoute: (key, val) =>\n      callback = val if typeof val is 'function'\n      callback or= => @[val].active(arguments...)\n      @route(key, callback)      \n\n\n  arraysEqual: (a, b) ->\n\n    return true if a is b\n    \n    return false if a is null or b is null\n    \n    return false if a.length isnt b.length\n\n    a.sort()\n    b.sort()\n\n    for i in [0..a.length]\n      return false if a[i] isnt b[i]\n    \n    true\n\nmodule.exports = App\n","\nR = jsRoutes.controllers.Tags\n\nclass labels\n\n  @getLabels: ->\n    $.getJSON R.getTags().url\n\n  @addLabel: (label, color) ->\n    route = R.addTag(label, color)\n    $.ajax(\n      type: route.type\n      url: route.url\n      dataType: 'json'\n    )\n\n  @updateLabelColor: (name, color) ->\n    route = R.updateTagColor(name, color)\n    $.ajax(\n      type: route.type\n      url: route.url\n      dataType: 'json'\n    )\n\n  @updateLabel: (name, newName) ->\n    route = R.updateTag(name, newName)\n    $.ajax(\n      type: route.type\n      url: route.url\n      dataType: 'json'\n    )    \n\n  @purgeLabels: (labels) ->\n    route = R.purgeTags(labels)\n    $.ajax(\n      type: route.type\n      url: route.url\n      dataType: 'json'\n    )\n\nmodule.exports = labels","\nclass Mac\n\n  @_genNonce: (issuedAt) ->\n    \"#{Date.now() - issuedAt}:#{Crypto.util.bytesToHex(Crypto.util.randomBytes(128/32))}\" \n\n  @sign: (secret, rs) ->\n    Crypto.util.bytesToBase64(Crypto.HMAC(Crypto.SHA1, rs, secret, { asBytes: yes }))\n\n  @toReqString: (nonce, method, uri, hostname, port, bodyHash, ext) ->\n    [nonce, method, uri, hostname, port, bodyHash or \"\", ext or \"\"].join(\"\\n\") + \"\\n\"\n\n  @createHeader: (session, xhr, req) ->\n    nonce = Mac._genNonce(parseInt(session.issuedTime))\n    rs    = Mac.toReqString(nonce, req.type, req.url, app.hostname or 'localhost', app.port or 80)\n    mac   = Mac.sign(session.secret, rs)\n\n    \"MAC id=\\\"#{session.access_token or session.key}\\\",nonce=\\\"#{nonce}\\\",mac=\\\"#{mac}\\\"\"\n\nmodule.exports = Mac","\n// Copyright (c) 2012 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/**\n * @fileoverview This file provides utility functions for position popups.\n */\n\n/**\n * Type def for rects as returned by getBoundingClientRect.\n * @typedef { {left: number, top: number, width: number, height: number,\n *             right: number, bottom: number}}\n */\nvar Rect;\n\n/**\n * Enum for defining how to anchor a popup to an anchor element.\n * @enum {number}\n */\nvar AnchorType = {\n  /**\n   * The popup's right edge is aligned with the left edge of the anchor.\n   * The popup's top edge is aligned with the top edge of the anchor.\n   */\n  BEFORE: 1,  // p: right, a: left, p: top, a: top\n\n  /**\n   * The popop's left edge is aligned with the right edge of the anchor.\n   * The popup's top edge is aligned with the top edge of the anchor.\n   */\n  AFTER: 2,  // p: left a: right, p: top, a: top\n\n  /**\n   * The popop's bottom edge is aligned with the top edge of the anchor.\n   * The popup's left edge is aligned with the left edge of the anchor.\n   */\n  ABOVE: 3,  // p: bottom, a: top, p: left, a: left\n\n  /**\n   * The popop's top edge is aligned with the bottom edge of the anchor.\n   * The popup's left edge is aligned with the left edge of the anchor.\n   */\n  BELOW: 4  // p: top, a: bottom, p: left, a: left\n};\n\n/**\n * Helper function for positionPopupAroundElement and positionPopupAroundRect.\n * @param {!Rect} anchorRect The rect for the anchor.\n * @param {!HTMLElement} popupElement The element used for the popup.\n * @param {AnchorType} type The type of anchoring to do.\n * @param {boolean} invertLeftRight Whether to invert the right/left\n *     alignment.\n */\nfunction positionPopupAroundRect(anchorRect, popupElement, type,\n                                 invertLeftRight) {\n  var popupRect = popupElement.getBoundingClientRect();\n  var availRect;\n  var ownerDoc = popupElement.ownerDocument;\n  var cs = ownerDoc.defaultView.getComputedStyle(popupElement);\n  var docElement = ownerDoc.documentElement;\n\n  if (cs.position == 'fixed') {\n    // For 'fixed' positioned popups, the available rectangle should be based\n    // on the viewport rather than the document.\n    availRect = {\n      height: docElement.clientHeight,\n      width: docElement.clientWidth,\n      top: 0,\n      bottom: docElement.clientHeight,\n      left: 0,\n      right: docElement.clientWidth\n    };\n  } else {\n    availRect = popupElement.offsetParent.getBoundingClientRect();\n  }\n\n  if (cs.direction == 'rtl')\n    invertLeftRight = !invertLeftRight;\n\n  // Flip BEFORE, AFTER based on alignment.\n  if (invertLeftRight) {\n    if (type == AnchorType.BEFORE)\n      type = AnchorType.AFTER;\n    else if (type == AnchorType.AFTER)\n      type = AnchorType.BEFORE;\n  }\n\n  // Flip type based on available size\n  switch (type) {\n    case AnchorType.BELOW:\n      if (anchorRect.bottom + popupRect.height > availRect.height &&\n          popupRect.height <= anchorRect.top) {\n        type = AnchorType.ABOVE;\n      }\n      break;\n    case AnchorType.ABOVE:\n      if (popupRect.height > anchorRect.top &&\n          anchorRect.bottom + popupRect.height <= availRect.height) {\n        type = AnchorType.BELOW;\n      }\n      break;\n    case AnchorType.AFTER:\n      if (anchorRect.right + popupRect.width > availRect.width &&\n          popupRect.width <= anchorRect.left) {\n        type = AnchorType.BEFORE;\n      }\n      break;\n    case AnchorType.BEFORE:\n      if (popupRect.width > anchorRect.left &&\n          anchorRect.right + popupRect.width <= availRect.width) {\n        type = AnchorType.AFTER;\n      }\n      break;\n  }\n  // flipping done\n\n  var style = popupElement.style;\n  // Reset all directions.\n  style.left = style.right = style.top = style.bottom = 'auto';\n\n  // Primary direction\n  switch (type) {\n    case AnchorType.BELOW:\n      if (anchorRect.bottom + popupRect.height <= availRect.height)\n        style.top = anchorRect.bottom + 'px';\n      else\n        style.bottom = '0';\n      break;\n    case AnchorType.ABOVE:\n      if (availRect.height - anchorRect.top >= 0)\n        style.bottom = availRect.height - anchorRect.top + 'px';\n      else\n        style.top = '0';\n      break;\n    case AnchorType.AFTER:\n      if (anchorRect.right + popupRect.width <= availRect.width)\n        style.left = anchorRect.right + 'px';\n      else\n        style.right = '0';\n      break;\n    case AnchorType.BEFORE:\n      if (availRect.width - anchorRect.left >= 0)\n        style.right = availRect.width - anchorRect.left + 'px';\n      else\n        style.left = '0';\n      break;\n  }\n\n  // Secondary direction\n  switch (type) {\n    case AnchorType.BELOW:\n    case AnchorType.ABOVE:\n      if (invertLeftRight) {\n        // align right edges\n        if (anchorRect.right - popupRect.width >= 0) {\n          style.right = availRect.width - anchorRect.right + 'px';\n\n        // align left edges\n        } else if (anchorRect.left + popupRect.width <= availRect.width) {\n          style.left = anchorRect.left + 'px';\n\n        // not enough room on either side\n        } else {\n          style.right = '0';\n        }\n      } else {\n        // align left edges\n        if (anchorRect.left + popupRect.width <= availRect.width) {\n          style.left = anchorRect.left + 'px';\n\n        // align right edges\n        } else if (anchorRect.right - popupRect.width >= 0) {\n          style.right = availRect.width - anchorRect.right + 'px';\n\n        // not enough room on either side\n        } else {\n          style.left = '0';\n        }\n      }\n      break;\n\n    case AnchorType.AFTER:\n    case AnchorType.BEFORE:\n      // align top edges\n      if (anchorRect.top + popupRect.height <= availRect.height) {\n        style.top = anchorRect.top + 'px';\n\n      // align bottom edges\n      } else if (anchorRect.bottom - popupRect.height >= 0) {\n        style.bottom = availRect.height - anchorRect.bottom + 'px';\n\n        // not enough room on either side\n      } else {\n        style.top = '0';\n      }\n      break;\n  }\n}\n\n/**\n * Positions a popup element relative to an anchor element. The popup element\n * should have position set to absolute and it should be a child of the body\n * element.\n * @param {!HTMLElement} anchorElement The element that the popup is anchored\n *     to.\n * @param {!HTMLElement} popupElement The popup element we are positioning.\n * @param {AnchorType} type The type of anchoring we want.\n * @param {boolean} invertLeftRight Whether to invert the right/left\n *     alignment.\n */\nfunction positionPopupAroundElement(anchorElement, popupElement, type,\n                                    invertLeftRight) {\n  var anchorRect = anchorElement.getBoundingClientRect();\n  positionPopupAroundRect(anchorRect, popupElement, type, invertLeftRight);\n}\n\n/**\n * Positions a popup around a point.\n * @param {number} x The client x position.\n * @param {number} y The client y position.\n * @param {!HTMLElement} popupElement The popup element we are positioning.\n */\nfunction positionPopupAtPoint(x, y, popupElement) {\n  var rect = {\n    left: x,\n    top: y,\n    width: 0,\n    height: 0,\n    right: x,\n    bottom: y\n  };\n  positionPopupAroundRect(rect, popupElement, AnchorType.BELOW);\n}\n\nmodule.exports = {\n  AnchorType: AnchorType,\n  positionPopupAroundElement: positionPopupAroundElement,\n  positionPopupAtPoint: positionPopupAtPoint\n};","\nclass SelectionMgr extends Spine.Module\n  @include Spine.Events\n  \n  _selections: []\n  \n  constructor: ->\n    super\n\n  setSelection: (sel) -> \n    @_selections = (value.clone() for value in sel)\n    @trigger 'selectionChanged'\n\n  selectOnly: (item) ->\n    @removeAll()\n    @selected(item)\n\n  toggleOnly: (item) ->\n    wasSelected = @isSelected(item)\n    @removeAll()\n    \n    if wasSelected\n      # @_selections.splice(index, 1)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", no\n\n    else\n      @_selections.push(item)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", yes      \n\n    false\n\n  toggle: (item) ->\n    index = @_indexof(item)\n    \n    if index > -1\n      @_selections.splice(index, 1)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", no\n\n    else\n      @_selections.push(item)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", yes      \n\n    false\n\n  selected: (item) ->\n    if @_indexof(item) is -1\n      @_selections.push(item)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", yes\n\n    false\n\n  count: -> @_selections.length\n\n  removeAll: ->\n    @removed(@_selections[lastIndex - 1]) while lastIndex = @_selections.length\n  \n  removed: (item) ->\n    index = @_indexof(item)\n    \n    if index > -1\n      @_selections.splice(index, 1)\n\n      @trigger 'selectionChanged'\n      @trigger \"selectionChanged_#{item.cid}\", no\n\n    false\n\n  isSelected: (item) -> \n    @_indexof(item) > -1\n  \n  getSelection: -> \n    @_selections\n  \n  hasSelection: -> \n    @count() > 0\n\n  # private\n\n  _indexof: (rec) ->\n    for r, i in @getSelection() when rec.eql(r)\n      return i\n    -1    \n\nmodule.exports = SelectionMgr","Mac = require('js/lib/mac')\n\nclass Session extends Spine.Module\n  @include Spine.Events\n  @include Spine.Log\n\n  logPrefix: '(Session)'\n\n  getScopeAccess: (name) ->\n    ;\n\n  constructor: (@app) ->\n    super\n\n    isAllowedAccess = (s, application) =>\n      return yes if s.superUser\n      for right in application.accessRights when s.accessRights.map((r) -> r.name).contains(right.name)\n        return yes\n      no\n\n    $.getJSON('/session')\n       .done (session) =>\n\n          return console.log('Error loading session!') if session.error\n\n          if session.suspended or session.changePasswordAtNextLogin\n            return setTimeout(-> @redirect '/')\n\n          @app.session = session         \n\n          @app.getApps().done (apps) =>\n\n            res = []\n            clbks = []\n\n            for x in apps when isAllowedAccess(session, x)\n              res.push \"/api/v1/#{x.name}/javascriptRoutes\"\n\n            for y in apps when isAllowedAccess(session, y)\n              res.push \"/#{y.name}/assets/javascripts/#{y.name}/tmpl.js\"\n              res.push \"/#{y.name}/assets/#{y.name}.js\"\n              clbks[\"#{y.name}.js\"] = => \n                Module = require(\"js/#{y.name}\")\n                setTimeout =>\n                  @app.modules[\"#{y.name}\"] = new Module({@app})\n\n            for z in apps when isAllowedAccess(session, z)\n              res.push \"/#{z.name}/assets/#{z.name}.css\"\n\n              setTimeout =>\n                yepnope\n                  load: res\n                  callback: clbks\n                  complete: =>                    \n                    \n                    $.ajaxSetup\n                      beforeSend: (xhr, req) =>          \n\n                        if req.url.search('/api/v1') is 0 # Authorization hdr only for API access\n                          hdr = Mac.createHeader(session, xhr, req)\n\n                          xhr.setRequestHeader('Authorization', hdr)\n\n                          req.url = \"#{@app.server}#{req.url}\"\n                          req.crossDomain = yes        \n\n                          req.xhrFields =\n                            withCredentials: yes\n\n                    setTimeout (=> @app.trigger 'loaded'), 0\n\n                    do @setUpLoginStatusChecks\n                , 0\n\n       .fail ->\n          console.log 'No session found!'\n\n  setUpLoginStatusChecks: (interval=30000) ->\n\n    doCheckSession = =>\n\n      $.getJSON('/session')\n       .done (s) =>\n\n          @log(\"getLoginStatus success:#{arguments}\")\n\n          return @app.trigger('session.error') if s.error\n\n          @app.trigger 'session.loggedin', s\n\n       .fail =>\n\n          @log(\"getLoginStatus error:#{arguments}\")\n\n          @app.trigger 'session.error'\n\n    do doCheckSession\n\n    @_refreshInterval = setInterval(doCheckSession, interval)\n\n  doLogout: =>\n    @log(\"doLogout\")\n\n    $.getJSON('/api/v1/logout')\n     .done => \n\n        @log(\"done doLogout:#{arguments}\")\n\n        @app.trigger 'session.loggedout'\n\nmodule.exports = Session","\nclass Tag extends Spine.Model\n\n  @configure 'Tag', 'name', 'color'\n\n  @Reload: ->\n\n    $.Deferred (deferred) =>\n\n      d = $.Deferred()\n\n      d.done (tags) => \n        @refresh(tags, clear: yes)\n        deferred.resolve @all()\n\n      app.labels.getLabels()\n         .done d.resolve\n\nmodule.exports = Tag"]}